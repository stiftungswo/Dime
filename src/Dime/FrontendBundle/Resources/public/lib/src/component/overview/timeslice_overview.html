<div class="row" style="margin-bottom: 5px;">
    <div class="col-xs-12 col-sm-2"></div>
    <daterange class="col-xs-12 col-sm-8" [(startdate)]="filterStartDate" [(enddate)]="filterEndDate" [null-allowed]="true"></daterange>
</div>
<div class="text-muted" *ngIf="entities.length == 0">
    Keine Einträge
</div>
<table *ngIf="entities.length > 0" class="table table-bordered table-hover form">
    <thead>
        <tr>
            <th style="width: 30px"></th>
            <th *ngIf="projectBased">Benutzer</th>
            <th class="col-sm-6">Aktivität</th>
            <th *ngIf="blendOutStartAndEnd">Datum</th>
            <th *ngIf="blendOutStartAndEnd == false">Start</th>
            <th *ngIf="blendOutStartAndEnd == false">Ende</th>
            <th>Dauer/Anzahl</th>
            <th width="60">Aktion</th>
        </tr>
    </thead>
    <tbody>
        <tr *ngFor="let entity of entities | timeslicedatefilter:filterStartDate:filterEndDate | orderBy:'startedAt'" (click)="selectRow($event, entity)" [class.info]="selectedTimeslices.contains(entity.id)">
            <td></td>
            <td *ngIf="projectBased"><user-select [(selectedEntity)]="entity.employee" [parentEmployees]="employees" (selectedEntityChange)="entity.addFieldtoUpdate('employee')"></user-select></td>
            <td><activity-select [is-readonly]="true" [(selectedEntity)]="entity.activity" [parent-activities]="activities" [project]="entity?.project?.id" (selectedEntityChange)="entity.addFieldtoUpdate('activity')"></activity-select></td>
            <td *ngIf="blendOutStartAndEnd"><dateinput [is-readonly]="true" style="width: 100%;" format="dd-MM-y" [(date)]="entity.startedAt"></dateinput></td>
            <td *ngIf="blendOutStartAndEnd == false"><dateinput style="width: 100%;" format="dd-MM-y HH:mm" [(date)]="entity.startedAt" (dateChange)="entity.addFieldtoUpdate('startedAt')"></dateinput></td>
            <td *ngIf="blendOutStartAndEnd == false"><dateinput style="width: 100%;" format="dd-MM-y HH:mm" [(date)]="entity.stoppedAt" (dateChange)="entity.addFieldtoUpdate('stoppedAt')"></dateinput></td>
            <td><input style="width: 100%;" class="form-control" [(ngModel)]="entity.value" (change)="addSaveField('value', entity)"/></td>
            <td><dime-button (click)="deleteEntity(entity.id)" fontAwesome="trash-o" color="red"></dime-button></td>
        </tr>
    </tbody>
</table>
<div class="DimeControlButtons container-inline">
    <div class="row form-inline">
        <div class="col-md-2">
            <label>Datum</label>
            <dateinput [(date)]="newEntryDate" [has-buttons]="true"></dateinput>
            <div>
                <span>automatisch anpassen</span>
                <input class="checkbox" type="checkbox" [(ngModel)]="updateNewEntryDate" />
                <help-tooltip text="Stellt das Datum nach dem Erfassen auf das Datum des neusten Eintrags im ausgewaehlten Zeitfenster"></help-tooltip>
            </div>
        </div>
        <div class="col-md-1">
        </div>
        <div *ngIf="projectBased == true" class="col-md-2">
            <label>Benutzer</label>
            <user-select [clearOnClose]="false" [parentEmployees]="employees" [(selectedEntity)]="employee" [useContext]="false"></user-select>
        </div>
        <div *ngIf="projectBased == false" class="col-md-2">
            <label>Benutzer</label>
            <user-select [clearOnClose]="false" [(selectedEntity)]="employee" [useContext]="true"></user-select>
        </div>
        <div *ngIf="allowProjectSelect" class="col-md-4">
            <label>Projekt</label>
            <project-select [hideArchived]="true" [(selectedEntity)]="selectedProject"></project-select>
        </div>
        <div class="col-md-2">
            <label>Aktivität</label>
            <activity-select [(selectedEntity)]="selectedActivity" [parent-activities]="activities" [project]="selectedProject?.id" [shortname]="true"></activity-select>
        </div>
        <div class="col-md-1">
            <label>Wert</label>
            <setting-edit namespace="/usr/defaults/timeslice" name="value" defaultvalue="8.4h"></setting-edit>
        </div>
        <div class="col-md-12" style="margin-top: 5px;">
            <dime-button primary
                         (click)="createEntity()"
                         glyphicon="plus"
            >Eintrag hinzufügen</dime-button>
            <dime-button primary
                         (click)="duplicateEntity()"
                         [enabled]="selectedTimeslices.length == 1"
                         fontAwesome="copy"
                         tooltipText="Exakt ein (1) Eintrag muss ausgewählt sein."
            >Duplizieren</dime-button>
            <dime-button
                    [enabled]="moveDialogEnabled()"
                    glyphicon="arrow-right"
                    (click)="moveDialogVisible = !moveDialogVisible"
                    tooltipText="Verschiebe die ausgewählten Einträge in ein anderes Projekt"
            >Verschieben</dime-button>
            <dime-button
                    (click)="reloadEvict()"
                    glyphicon="refresh"></dime-button>
        </div>
        <div class="col-sm-12" style="padding-top: 10px" *ngIf="moveDialogVisible">
            <div class="clearfix"></div>
            <div class="panel panel-default">
                <div class="panel-heading">Verschieben</div>
                <div class="panel-body">
                    <div class="row">
                        <div class="col-md-4">
                            <label>Projekt</label>
                            <project-select [hideArchived]="true" [(selectedEntity)]="moveTargetProject"></project-select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-2" style="padding-top: 10px">
                            <dime-button glyphicon="arrow-right" (click)="moveTimeslices()" [enabled]="moveTargetProject != null" primary>Verschieben</dime-button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
