<loading-container *ngIf="entity == null"></loading-container>
<div *ngIf="entity != null">
    <form #editform="ngForm">
        <dime-box label="{{ entity?.firstName }} {{ entity?.lastName }} bearbeiten">
            <div boxBody class="form-horizontal">
                <dime-form-group horizontal label="Anrede">
                    <input required ngControl="salutation" class="form-control" [(ngModel)]="entity.salutation"
                           (change)="addSaveField('salutation')">
                </dime-form-group>

                <dime-form-group horizontal label="Vorname">
                    <input required ngControl="firstName" class="form-control" [(ngModel)]="entity.firstName"
                           (change)="addSaveField('firstName')">
                </dime-form-group>

                <dime-form-group horizontal label="Nachname">
                    <input required ngControl="lastName" class="form-control" [(ngModel)]="entity.lastName"
                           (change)="addSaveField('lastName')">
                </dime-form-group>

                <dime-form-group horizontal label="Firma">
                    <company-select ngControl="company"
                                    [ngModel]="entity.company"
                                    (ngModelChange)="entity.company=$event;addSaveField('company')"></company-select>
                </dime-form-group>

                <dime-form-group horizontal label="E-Mail">
                    <input type="email" ngControl="email" class="form-control" [(ngModel)]="entity.email"
                           (change)="addSaveField('email')">
                </dime-form-group>

                <dime-form-group horizontal label="Kommentar">
                    <textarea ngControl="comment" class="form-control" [(ngModel)]="entity.comment"
                              (change)="addSaveField('comment')"></textarea>
                </dime-form-group>

                <div *ngIf="!hasCompany(entity)">
                    <dime-form-group horizontal label="Tarif">
                        <rate-group-select required
                                           ngControl="rateGroup"
                                           [ngModel]="entity.rateGroup"
                                           (ngModelChange)="entity.rateGroup=$event;addSaveField('rateGroup')"></rate-group-select>
                    </dime-form-group>

                    <dime-form-group horizontal class="checkbox" help="Aktiviere diese Checkbox, wenn du möchtest, dass Projekte für diesen Kunden standardmässig verrechnet werden sollen. Du kannst dies aber pro Projekt nochmals individuell anpassen.">
                        <label>
                            <input required type="checkbox" [(ngModel)]="entity.chargeable" (change)="addSaveField('chargeable')"> Verrechenbar?
                        </label>
                    </dime-form-group>

                    <dime-form-group horizontal class="checkbox" help="Aktiviere diese Checkbox, wenn du möchtest, dass dieser Kunde bei der Erstellung von neuen Offerten oder Projekten nicht angezeigt werden soll. Auf den Adressexport hat dies keinen Einfluss.">
                        <label>
                            <input required type="checkbox" [(ngModel)]="entity.hideForBusiness" (change)="addSaveField('hideForBusiness')"> Nicht anzeigen in Dime?
                        </label>
                    </dime-form-group>
                </div>

                <p *ngIf="hasCompany(entity)"><b>Hinweis: </b> Adressen und Telefonnummern, welche für alle Personen
                    einer Firma gültig
                    sein sollen, können <a
                            [routerLink]="companyEditUrl">hier</a>
                    erfasst werden.</p>
            </div>
        </dime-box>

        <person-address-overview [person]="entity.id"></person-address-overview>
        <person-phone-overview [person]="entity.id"></person-phone-overview>

        <div class="DimeControlButtons">
            <save-button [valid]="editform.valid" (click)="saveEntity()"></save-button>
            <dime-button *ngIf="hasCompany(entity)" (click)="releaseFromCompany(entity)"
                         fontAwesome="times" warning>Von Firma lösen
            </dime-button>
            <dime-button (click)="reloadEvict()" glyphicon="refresh"></dime-button>
        </div>
    </form>
    <edit-footer [entity]="entity"></edit-footer>
</div>
