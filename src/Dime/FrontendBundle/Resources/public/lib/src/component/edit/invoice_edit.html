<template [ngIf]="entity != null">
  <h2 class="page-header">{{entity.name}}&nbsp;</h2>
  <div class ="nav-tabs-custom">
    <ul class="nav nav-tabs">
      <template [ngIf]="!entity.project.offers.isEmpty" >
        <li *ngFor="let offer of entity.project.offers"><a data-toggle="tab" (click)="openOffer(offer.id)">Offerte {{offer.id}}</a></li>
      </template>
      <li *ngIf="entity.project != null"><a data-toggle="tab" (click)="openProject()">Projekt {{entity.project.id}}</a></li>
      <template [ngIf]="project != null">
        <li *ngFor="let invoice of project.invoices" [class.active]="invoice.id == entity.id"><a *ngIf="invoice.id == entity.id" data-toggle="tab">Rechnung {{invoice.id}}</a><a *ngIf="invoice.id != entity.id" data-toggle="tab" (click)="openInvoice(invoice.id)">Rechnung {{invoice.id}}</a></li>
      </template>
      <li *ngIf="project == null" class="active"><a data-toggle="tab">Rechnung {{entity.id}}</a></li>
      <li><a *ngIf="project != null" data-toggle="tab" (click)="createInvoice()"><i class="fa fa-fw fa-plus"></i> Rechnung erstellen</a></li>
    </ul>

    <div class="tab-content">
      <form #editform="ngForm">
        <div class="tab-pane active">
          <div class="form-horizontal">
            <div class="form-group">
              <label class="col-md-2 control-label">Name</label>
              <div class="col-md-4">
                <input class="form-control" style="width: 100%;" type="text" [(ngModel)]="entity.name" (change)="addSaveField('name')">
              </div>
            </div>
            <div class="form-group" *ngIf="entity.project != null">
              <label class="col-md-2 control-label">Auftrag</label>
              {{entity.project.name}}
            </div>
            <div class="form-group">
              <label class="col-md-2 control-label">Kunde</label>
              <customer-select class="col-md-4" [(selectedEntity)]="entity.customer" (selectedEntityChange)="addSaveField('customer')"></customer-select>
            </div>
            <div class="form-group">
              <label class="col-sm-2 control-label">Verantwortlicher Mitarbeiter</label>
              <user-select class="col-sm-4" [(selectedEntity)]="entity.accountant" (selectedEntityChange)="addSaveField('accountant')"></user-select>
            </div>
            <div class="form-group">
              <label class="col-md-2 control-label">Startdatum</label>
              <dateinput class="col-md-4" [(date)]="entity.start" (dateChange)="addSaveField('start')"></dateinput>
            </div>
            <div class="form-group">
              <label class="col-md-2 control-label">Enddatum</label>
              <dateinput class="col-md-4" [(date)]="entity.end" (dateChange)="addSaveField('end')"></dateinput>
            </div>
          </div>
          <div class="form-group">
            <label class="control-label">Beschreibung</label>
            <textarea class="form-control" [(ngModel)]="entity.description" (change)="addSaveField('description')"></textarea>
          </div>
        </div>
      </form>
    </div>
  </div>
  <invoiceitem-overview [invoice]="entity.id" #invoiceitemOverview></invoiceitem-overview>
  <div class="row">
    <div class="col-md-6"><invoicecostgroup-overview [invoice]="entity.id" #invoicecostgroupOverview></invoicecostgroup-overview></div>
    <div class="col-md-6"><invoicediscount-overview [invoice]="entity.id"></invoicediscount-overview></div>
    <div class="col-md-6">
      <div class="box box-primary">
        <div class="box-header with-border">
          <h3 class="box-title">Berechnung</h3>
        </div>
        <div class="box-body">
          <div class="row"><label class="col-xs-6 control-label">Subtotal</label><div class="col-xs-6">{{entity.breakdown.subtotal}}</div></div>
          <div class="row"><label class="col-xs-6 control-label">Total Abzüge</label><div class="col-xs-6">{{entity.totalDiscounts}}</div></div>
          <div class="row"><label class="col-xs-6 control-label">MwSt. </label><div class="col-xs-6">{{entity.breakdown.vat}}</div></div>
          <div class="row"><label class="col-xs-6 control-label">Total</label><div class="col-xs-6">{{entity.breakdown.total}}</div></div>
          <div class="row">
            <label class="col-sm-6 control-label">Fixpreis</label>
            <div class="col-sm-6">
              <input class="form-control" type="text" [(ngModel)]="entity.fixedPrice" (change)="addSaveField('fixedPrice')">
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>
<div class="DimeControlButtons">
  <dime-button primary (click)="saveEntity()"><error-icon value="saveState" timeout="20"></error-icon></dime-button>
  <dime-button primary glyphicon="magnet"
               tooltipText="Synchronisiert die Aktivitäten mit dem Ursprungsprojekt und setzt den Sachbearbeiter auf Dich"
               (click)="updateInvoicefromProject()"> Update </dime-button>
  <dime-button primary glyphicon="print" (click)="printInvoice()"> Rechnung </dime-button>
  <dime-button primary glyphicon="print" (click)="printAufwandsbericht()"> Aufwandsbericht </dime-button>
  <dime-button glyphicon="refresh" (click)="reloadEvict()"></dime-button>
</div>
