<h2 class="page-header">{{entity.name}}&nbsp;</h2>
<div class ="nav-tabs-custom">
  <ul class="nav nav-tabs">
    <li ng-if="!entity.project.offers.isEmpty" ng-repeat="offer in entity.project.offers"><a data-toggle="tab" ng-click="openOffer(offer.id)">Offerte {{offer.id}}</a></li>
    <li ng-if="entity.project != null"><a data-toggle="tab" ng-click="openProject()">Projekt {{entity.project.id}}</a></li>
    <li ng-repeat="invoice in project.invoices" ng-class="invoice.id == entity.id ? 'active' : ''"><a ng-if="invoice.id == entity.id" data-toggle="tab">Rechnung {{invoice.id}}</a><a ng-if="invoice.id != entity.id" data-toggle="tab" ng-click="openInvoice(invoice.id)">Rechnung {{invoice.id}}</a></li>
    <li ng-if="project == null" class="active"><a data-toggle="tab">Rechnung {{entity.id}}</a></li>
    <li><a ng-if="project != null" data-toggle="tab" ng-click="createInvoice()"><i class="fa fa-fw fa-plus"></i> Rechnung erstellen</a></li>
  </ul>

  <div class="tab-content" ng-form name="editform">
    <div class="tab-pane active">
      <div class="form-horizontal">
        <div class="form-group">
          <label class="col-md-2 control-label">Name</label>
          <div class="col-md-4">
            <input class="form-control" style="width: 100%;" type="text" ng-model="entity.name" ng-change="addSaveField('name')">
          </div>
        </div>
        <div class="form-group" ng-if="entity.project">
          <label class="col-md-2 control-label">Auftrag</label>
          {{entity.project.name}}
        </div>
        <div class="form-group">
          <label class="col-md-2 control-label">Kunde</label>
          <customer-select class="col-md-4" customer="entity.customer" callback="addSaveField(name)" field="'customer'"></customer-select>
        </div>
        <div class="form-group">
          <label class="col-sm-2 control-label">Verantwortlicher Mitarbeiter</label>
          <user-select class="col-sm-4" user="entity.accountant" callback="addSaveField(name)"
                       field="'accountant'"></user-select>
        </div>
        <div class="form-group">
          <label class="col-md-2 control-label">Startdatum</label>
          <dateinput class="col-md-4" date="entity.start" field="'start'" callback="addSaveField(name)"></dateinput>
        </div>
        <div class="form-group">
          <label class="col-md-2 control-label">Enddatum</label>
          <dateinput class="col-md-4" date="entity.end" field="'end'" callback="addSaveField(name)"></dateinput>
        </div>
      </div>
      <div class="form-group">
        <label class="control-label">Beschreibung</label>
        <textarea class="form-control" ng-model="entity.description" ng-change="addSaveField('description')"></textarea>
      </div>
    </div>
  </div>
</div>
<invoiceitem-overview invoice="entity.id" parentCallback="setInvoiceItemOverview(param1)"></invoiceitem-overview>
<div class="row">
  <div class="col-md-6"><invoicecostgroup-overview invoice="entity.id" onUpdate="validateCostgroups(entities)"></invoicecostgroup-overview></div>
  <div class="col-md-6"><invoicediscount-overview invoice="entity.id"></invoicediscount-overview></div>
  <div class="col-md-6">
    <div class="box box-primary">
      <div class="box-header with-border">
        <h3 class="box-title">Berechnung</h3>
      </div>
      <div class="box-body">
        <div class="row"><label class="col-xs-6 control-label">Subtotal</label><div class="col-xs-6">{{entity.breakdown.subtotal}}</div></div>
        <div class="row"><label class="col-xs-6 control-label">Total Abzüge</label><div class="col-xs-6">{{entity.totalDiscounts}}</div></div>
        <div class="row"><label class="col-xs-6 control-label">MwSt. </label><div class="col-xs-6">{{entity.breakdown.vat}}</div></div>
        <div class="row"><label class="col-xs-6 control-label">Total</label><div class="col-xs-6">{{entity.breakdown.total}}</div></div>
        <div class="row">
          <label class="col-sm-6 control-label">Fixpreis</label>
          <div class="col-sm-6">
            <input class="form-control" type="text" ng-model="entity.fixedPrice" ng-change="addSaveField('fixedPrice')">
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="DimeControlButtons">
  <dime-button primary click="saveEntity()"><error-icon value="saveState" timeout="20"></error-icon></dime-button>
  <dime-button primary glyphicon="magnet"
               tooltipText="Synchronisiert die Aktivitäten mit dem Ursprungsprojekt und setzt den Sachbearbeiter auf Dich"
               click="updateInvoicefromProject()"> Update </dime-button>
  <dime-button primary glyphicon="print" click="printInvoice()"> Rechnung </dime-button>
  <dime-button primary glyphicon="print" click="printAufwandsbericht()"> Aufwandsbericht </dime-button>
  <dime-button glyphicon="refresh" click="reload(evict: true)"></dime-button>
</div>
