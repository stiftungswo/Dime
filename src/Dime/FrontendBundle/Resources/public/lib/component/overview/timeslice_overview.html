<div class="row" style="margin-bottom: 5px;">
    <div class="col-xs-12 col-sm-2"></div>
    <daterange class="col-xs-12 col-sm-8" startdate="filterStartDate" enddate="filterEndDate" null-allowed="true"></daterange>
</div>
<table class="table table-bordered table-hover form">
    <thead>
        <tr>
            <th style="width: 30px"></th>
            <th ng-if="projectBased">Benutzer</th>
            <th class="col-sm-6">Aktivität</th>
            <th ng-if="blendOutStartAndEnd">Datum</th>
            <th ng-if="blendOutStartAndEnd == false">Start</th>
            <th ng-if="blendOutStartAndEnd == false">Ende</th>
            <th>Dauer/Anzahl</th>
            <th width="60">Aktion</th>
        </tr>
    </thead>
    <tbody ng-if="entities != null">
        <tr ng-repeat="entity in entities | timeslicedatefilter: filterStartDate:filterEndDate | orderBy:'startedAt'" ng-click="selectRow($event, entity)" ng-class="selectedTimeslices.contains(entity.id) ? 'info': ''">
            <td></td>
            <td ng-if="projectBased"><user-select user="entity.employee" parent-employees="employees" callback="entity.addFieldtoUpdate(name)" field="'employee'"></user-select></td>
            <td><activity-select is-readonly="true" activity="entity.activity" parent-activities="activities" project="entity.project.id" callback="entity.addFieldtoUpdate(name)" field="'activity'"></activity-select></td>
            <td ng-if="blendOutStartAndEnd"><dateinput is-readonly="true" style="width: 100%;" format="'dd-MM-y'" date="entity.startedAt"></dateinput></td>
            <td ng-if="blendOutStartAndEnd == false"><dateinput style="width: 100%;" format="'dd-MM-y HH:mm'" date="entity.startedAt" field="'startedAt'" callback="entity.addFieldtoUpdate(name)"></dateinput></td>
            <td ng-if="blendOutStartAndEnd == false"><dateinput style="width: 100%;" format="'dd-MM-y HH:mm'" date="entity.stoppedAt" field="'stoppedAt'" callback="entity.addFieldtoUpdate(name)"></dateinput></td>
            <td><input style="width: 100%;" class="form-control" ng-model="entity.value" ng-change="addSaveField('value', entity)"/></td>
            <td><button type="button" class="btn btn-default" ng-click="deleteEntity(entity.id)"><i class="fa fa-fw fa-trash-o" style="color:red"></i></button></td>
        </tr>
    </tbody>
</table>
<div class="DimeControlButtons container-inline">
    <div class="row form-inline">
        <div class="col-md-2">
            <label>Datum</label>
            <dateinput date="newEntryDate" has-buttons="true"></dateinput>
            <div>
                <span>automatisch anpassen</span>
                <input class="checkbox" type="checkbox" ng-model="updateNewEntryDate" />
                <help-tooltip text="Stellt das Datum nach dem Erfassen auf das Datum des neusten Eintrags im ausgewaehlten Zeitfenster"></help-tooltip>
            </div>
        </div>
        <div class="col-md-1">
        </div>
        <div ng-if="projectBased == true" class="col-md-2">
            <label>Benutzer</label>
            <user-select clearOnClose="false" parent-employees="employees" user="employee" useContext="false"></user-select>
        </div>
        <div ng-if="projectBased == false" class="col-md-2">
            <label>Benutzer</label>
            <user-select clearOnClose="false" user="employee" useContext="true"></user-select>
        </div>
        <div ng-if="allowProjectSelect" class="col-md-4">
            <label>Projekt</label>
            <project-select hideArchived="true" project="selectedProject"></project-select>
        </div>
        <div class="col-md-2">
            <label>Aktivität</label>
            <activity-select activity="selectedActivity" parent-activities="activities" project="selectedProject.id" field="'activity'" shortname="true"></activity-select>
        </div>
        <div class="col-md-1">
            <label>Wert</label>
            <setting-edit namespace="'/usr/defaults/timeslice'" name="'value'" defaultvalue="'8.4h'"></setting-edit>
        </div>
        <div class="col-md-12" style="margin-top: 5px;">
            <dime-button primary ng-click="createEntity()" glyphicon="plus">Eintrag hinzufügen</dime-button>
            <dime-button primary enabled="selectedTimeslices.length == 1" ng-click="duplicateEntity()" glyphicon="asterisk"
                         tooltipText="Exakt ein (1) Eintrag muss ausgewählt sein.">Duplizieren</dime-button>
            <dime-button enabled="moveDialogEnabled()" glyphicon="arrow-right" ng-click="moveDialogVisible = !moveDialogVisible"
                         tooltipText="Verschiebe die ausgewählten Einträge in ein anderes Projekt">Verschieben</dime-button>
            <dime-button ng-click="reload(evict: true)" glyphicon="refresh"></dime-button>
        </div>
        <div class="col-sm-12" style="padding-top: 10px" ng-if="moveDialogVisible">
            <div class="clearfix"></div>
            <div class="panel panel-default">
                <div class="panel-heading">Verschieben</div>
                <div class="panel-body">
                    <div class="row">
                        <div class="col-md-4">
                            <label>Projekt</label>
                            <project-select hideArchived="true" project="moveTargetProject"></project-select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-2" style="padding-top: 10px">
                            <dime-button glyphicon="arrow-right" ng-click="moveTimeslices()" enabled="moveTargetProject != null" primary>Verschieben</dime-button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
